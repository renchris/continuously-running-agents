# Claude Code Agent TMUX Configuration
# Optimized for running continuous agents on OVHCloud
#
# Installation:
#   cp config/.tmux.conf ~/.tmux.conf
#   tmux source-file ~/.tmux.conf

###############################################################################
# General Settings
###############################################################################

# Enable mouse support for easier navigation
set -g mouse on

# Increase scrollback buffer size
set-option -g history-limit 50000

# Start window numbering at 1 (easier to reach)
set -g base-index 1
set -g pane-base-index 1

# Renumber windows sequentially after closing any of them
set -g renumber-windows on

# Faster command sequences (no delay after escape)
set -s escape-time 0

# Increase tmux messages display duration
set -g display-time 4000

# Refresh status bar more frequently
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

###############################################################################
# Key Bindings
###############################################################################

# Reload config file easily
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Better pane splitting (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Quick pane cycling
bind -n C-q select-pane -t :.+

# Pane resizing with vim keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick window switching
bind -n M-Left previous-window
bind -n M-Right next-window

###############################################################################
# Activity Monitoring
###############################################################################

# Monitor for activity in windows
setw -g monitor-activity on
set -g visual-activity on

# Don't show activity in status bar (less distraction)
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
set -g bell-action none

###############################################################################
# Status Bar Configuration
###############################################################################

# Status bar position
set -g status-position bottom

# Status bar colors (dark theme)
set -g status-bg colour234
set -g status-fg colour137

# Left status bar: Session name and window count
set -g status-left '#[fg=colour233,bg=colour241,bold] #S #[fg=colour241,bg=colour234] #I/#W '
set -g status-left-length 40

# Right status bar: System info, date, and time
set -g status-right '#[fg=colour233,bg=colour241,bold] CPU: #(top -bn1 | grep "Cpu(s)" | sed "s/.*, *\([0-9.]*\)%* id.*/\1/" | awk "{print 100 - \$1}"%%) #[fg=colour233,bg=colour245,bold] %Y-%m-%d #[fg=colour233,bg=colour245,bold] %H:%M:%S '
set -g status-right-length 80

# Window status
setw -g window-status-current-format '#[fg=colour234,bg=colour37] #I:#W#F '
setw -g window-status-format '#[fg=colour244,bg=colour234] #I:#W#F '

# Pane borders
set -g pane-border-style 'fg=colour238'
set -g pane-active-border-style 'fg=colour37'

# Message text
set -g message-style 'fg=colour232,bg=colour37,bold'

###############################################################################
# Window Titles
###############################################################################

# Enable window titles
set -g set-titles on

# Title format: session name - window name
set -g set-titles-string '#S - #W'

###############################################################################
# Copy Mode (Vi-style)
###############################################################################

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Copy mode bindings (more vim-like)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

###############################################################################
# Agent-Specific Settings
###############################################################################

# Logging for agent sessions
# Automatically log output to file
# bind L pipe-pane -o 'cat >>~/agents/logs/tmux-#S-#W.log' \; display-message 'Started logging to ~/agents/logs/tmux-#S-#W.log'
# bind l pipe-pane \; display-message 'Ended logging'

# Quick access to agent monitoring
bind m new-window -n monitoring 'htop'
bind l new-window -n logs 'tail -f ~/agents/logs/*.log'

###############################################################################
# Session Management
###############################################################################

# Quick session switching
bind S choose-tree -Zs

# Create new session
bind C command-prompt -p "New Session:" "new-session -A -s '%%'"

# Kill session
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

###############################################################################
# Pane Management
###############################################################################

# Synchronize panes (send command to all panes)
bind s setw synchronize-panes

# Zoom pane
bind z resize-pane -Z

###############################################################################
# Clipboard Integration (for remote access)
###############################################################################

# For Linux (requires xclip)
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# For macOS
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'

###############################################################################
# Plugin Manager (optional - uncomment to use)
###############################################################################

# List of plugins
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# Initialize TMUX plugin manager (keep this line at the very bottom)
# run '~/.tmux/plugins/tpm/tpm'
